<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gestión de Usuarios</h2>
        <button class="btn btn-primary" (click)="openModal()">
            <i class="bi bi-person-plus me-2"></i> Nuevo Usuario
        </button>
    </div>

    <!-- Filters -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" placeholder="Buscar por Nombre o Email"
                        [(ngModel)]="filterSearch" (keyup.enter)="onFilterChange()">
                </div>
                <div class="col-md-2">
                    <select class="form-select" [(ngModel)]="filterRole" (change)="onFilterChange()">
                        <option value="">Todos los Roles</option>
                        <option value="admin">Admin</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="cajero">Cajero</option>
                        <option value="bodega">Bodega</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" [(ngModel)]="filterBranch" (change)="onFilterChange()">
                        <option value="">Todas las Sucursales</option>
                        <option *ngFor="let branch of branches" [value]="branch._id">{{ branch.name }}</option>
                    </select>
                </div>
                <div class="col-md-3 d-grid">
                    <button class="btn btn-outline-secondary" (click)="onFilterChange()">
                        <i class="bi bi-search me-2"></i> Buscar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Sucursal</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of users">
                        <td>{{ user.name }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            <span class="badge" [ngClass]="{
                                    'bg-danger': user.role === 'admin',
                                    'bg-warning text-dark': user.role === 'supervisor',
                                    'bg-info text-dark': user.role === 'cajero',
                                    'bg-secondary': user.role === 'bodega'
                                }">
                                {{ user.role | titlecase }}
                            </span>
                        </td>
                        <td>{{ getBranchName(user.branch) }}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-2" (click)="openModal(user)">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user._id)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="users.length === 0">
                        <td colspan="5" class="text-center py-4">No se encontraron usuarios.</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Pagination -->
        <div class="card-footer d-flex justify-content-between align-items-center" *ngIf="totalDocs > limit">
            <span class="text-muted small">Mostrando {{ users.length }} de {{ totalDocs }} usuarios</span>
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="page === 1">
                        <button class="page-link" (click)="changePage(page - 1)">Anterior</button>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link">Página {{ page }} de {{ totalPages }}</span>
                    </li>
                    <li class="page-item" [class.disabled]="page === totalPages">
                        <button class="page-link" (click)="changePage(page + 1)">Siguiente</button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- User Form Modal -->
<app-user-form-modal [isOpen]="isModalOpen" [isEditing]="isEditing" [userForm]="userForm" [branches]="branches"
    (close)="closeModal()" (save)="saveUser()">
</app-user-form-modal>